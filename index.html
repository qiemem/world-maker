<!DOCTYPE html>
<html>
  <head>
    <title>World Maker</title>
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css" />
    <link rel="stylesheet" href="node_modules/codemirror/theme/solarized.css" />
    <link rel="stylesheet" href="editor/editor.css" />
    <link rel="stylesheet" href="world/world.css" />
    <style type="text/css">
      body {
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>
  <body onload="init();">
    <script src ="node_modules/d3/d3.min.js"></script>
    <script src="node_modules/three/three.min.js"></script>
    <script src="libs/FirstPersonControls.js"></script>
    <script src="node_modules/three/examples/js/controls/TrackballControls.js"></script>
    <script src="node_modules/three/examples/js/libs/tween.min.js"></script>
    <script src="libs/THREEx.WindowResize.js"></script>
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <script src="node_modules/codemirror/mode/javascript/javascript.js"></script>
    <script src="node_modules/codemirror/addon/selection/mark-selection.js"></script>
    <script src="node_modules/acorn/acorn.js"></script>
    <script src="node_modules/acorn/acorn_loose.js"></script>
    <script src="node_modules/acorn/util/walk.js"></script>
    <script src="editor/block.js"></script>
    <script src="editor/editor.js"></script>
    <script src="world/world.js"></script>
    <script src="agency/agency.js"></script>
    <script>
      var editor, scene;
      
      function init() {
        World.init(document.body);
        scene = new agency.Agent(World.scene());
        editor = new Editor(document.body);
        editor.editor.setValue("var cursor = scene.cursor().fd(5);\n");
        editor.editor.setCursor({line: 2, ch:1});
        document.body.addEventListener('keypress', function(e) {
          if (e.keyCode === '`'.charCodeAt(0)) {
            editor.toggleSlide();
            World.controls.freeze = editor.visible;
            if (editor.visible) {
              // Need setTimeout; otherwise the key actually registers in the 
              // editor, typing `
              setTimeout(function(){editor.editor.focus();});
              World.switchControls(World.ControlModes.TRACKBALL);
            } else {
              editor.editor.getInputField().blur();
              World.switchControls(World.ControlModes.FIRST_PERSON);
            }
          }
          return false;
        });
        editor.addEvalListener(World.reset);
      }
    </script>
  </body>
</html>
