<!DOCTYPE html>
<html>
  <head>
    <title>World Maker</title>
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css" />
    <link rel="stylesheet" href="node_modules/codemirror/theme/solarized.css" />
    <link rel="stylesheet" href="editor/editor.css" />
    <link rel="stylesheet" href="world/world.css" />
    <style type="text/css">
      body {
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
      }
    </style>

    <script src="http://localhost:9001/ws"></script>
  </head>
  <body onload="init();">
    <script src ="node_modules/d3/d3.min.js"></script>
    <script src="node_modules/three/three.min.js"></script>
    <script src="node_modules/three/examples/js/controls/FirstPersonControls.js"></script>
    <script src="libs/THREEx.WindowResize.js"></script>
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <script src="node_modules/codemirror/mode/javascript/javascript.js"></script>
    <script src="editor/editor.js"></script>
    <script src="world/world.js"></script>
    <script src="agency/agency.js"></script>
    <script>
      var editor, scene;
      
      function init() {
        World.init(document.body);
        scene = new agency.Agent(World.scene);
        editor = new Editor(document.body);
        document.body.addEventListener('keypress', function(e) {
          if (e.keyCode === '`'.charCodeAt(0)) {
            editor.toggleSlide();
            World.controls.freeze = editor.visible;
            if (editor.visible) {
              // Otherwise the key actually registers in the editor, typing `
              setTimeout(function(){editor.editor.focus();});
            } else {
              editor.editor.getInputField().blur();
            }
          }
          return false;
        });
        // TODO: Reset scene matrix on eval
        editor.addEvalListener(World.reset);
      }
    </script>
  </body>
</html>
